# 実装計画

- [ ] 1. プロジェクト基盤とデータモデルの構築

  - Go modules でプロジェクト構造を作成し、基本的なディレクトリ構成を設定する
  - カードデータモデル（BaseCard、FriendCard、SupportCard、FieldCard）を実装する
  - SQLite データベース接続と GORM セットアップを行う
  - カードデータ管理システムを実装する：
    - Go embed を使用してカードデータをバイナリに埋め込む機能
    - Go embed を使用してカード画像をバイナリに埋め込む機能
    - 初期カードセットのデータファイル作成（internal/assets/cards.json）
    - カード画像ファイルの準備（internal/assets/images/）
    - 埋め込みデータから SQLite データベースへの初期化機能
    - リソース管理システム（画像キャッシュとメモリ効率化）
  - _要件: 3.1, 3.2, 3.5_

- [ ] 2. カード管理システムの実装

  - [ ] 2.1 カードサービスとリポジトリの実装

    - CardService と CardRepository を実装し、CRUD 操作を提供する
    - カード検索機能（タイプ別、色別、名前検索）を実装する
    - カードデータの検証機能を実装する
    - _要件: 3.1, 3.3, 3.4_

  - [ ] 2.2 デッキ管理機能の実装
    - デッキ構築ロジック（50 枚制限、同一カード 4 枚制限）を実装する
    - デッキ保存・読み込み機能を実装する
    - デッキ検証機能（ルール準拠チェック）を実装する
    - _要件: 1.1, 1.3, 1.4, 1.5_

- [ ] 3. ゲーム状態管理システムの実装

  - [ ] 3.1 ゲーム状態モデルの実装

    - GameState、Player 構造体を実装する
    - ゲーム状態の並行安全な操作（sync.RWMutex）を実装する
    - ゲーム状態のシリアライゼーション機能を実装する
    - _要件: 2.1, 2.2, 4.9, 4.12_

  - [ ] 3.2 ゲーム状態サービスの実装
    - GameStateService を実装し、ゲーム作成・更新・削除機能を提供する
    - ゲーム状態の永続化機能（SQLite 保存）を実装する
    - ゲーム状態の復元機能を実装する
    - _要件: 2.1, 2.8_

- [ ] 4. ゲームルールエンジンの実装

  - [ ] 4.1 基本ルールプロセッサの実装

    - RuleProcessor を実装し、基本的なルール検証機能を提供する
    - カードプレイの検証（コスト支払い、色制限）を実装する
    - フェーズ遷移のルール検証を実装する
    - _要件: 4.1, 4.7, 4.8, 4.9_

  - [ ] 4.2 アクションシステムの実装

    - GameAction 型とその具体的な実装（PlayCardAction、AttackAction 等）を作成する
    - アクション処理パイプラインを実装する
    - アクション結果とイベントシステムを実装する
    - _要件: 2.4, 4.10, 4.11_

  - [ ] 4.3 フェーズ管理システムの実装
    - PhaseManager を実装し、5 つのフェーズ（スタート、ドロー、エネルギー、メイン、エンド）を管理する
    - 各フェーズの自動処理ロジックを実装する
    - フェーズ間の状態変更とイベント発火を実装する
    - _要件: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6_

- [ ] 5. アタック・バトルシステムの実装

  - [ ] 5.1 アタック処理の実装

    - アタック宣言の検証と処理を実装する
    - 直接アタックとふれんどアタックの処理を分岐実装する
    - アタック可能性の判定（登場ターン制限、アクティブ状態）を実装する
    - _要件: 2.6, 2.7_

  - [ ] 5.2 ブロック・バトル解決の実装
    - ブロック宣言の処理を実装する
    - カウンタータイミングの処理を実装する
    - バトル解決（パワー比較、破壊処理）を実装する
    - 負のエネルギーエリアへのダメージ処理を実装する
    - _要件: 2.8, 2.9, 2.10, 2.11, 2.12_

- [ ] 6. 勝利条件とゲーム終了処理の実装

  - 勝利条件の判定（負のエネルギー 7 枚、デッキ切れ）を実装する
  - ゲーム終了処理とクリーンアップを実装する
  - ゲーム結果の記録と表示を実装する
  - _要件: 2.13, 2.14, 2.15_

- [ ] 7. AI エンジンの実装

  - [ ] 7.1 基本 AI 戦略の実装

    - BasicStrategy を実装し、3 段階の難易度設定を提供する
    - カード価値評価システムを実装する
    - 基本的な行動選択ロジック（カードプレイ、アタック、ブロック）を実装する
    - _要件: 2.1（AI 対戦）_

  - [ ] 7.2 AI 行動決定システムの実装
    - AIEngine を実装し、ゲーム状態に基づく行動決定を行う
    - ターン管理とフェーズごとの AI 行動を実装する
    - AI 思考時間の制御と難易度調整を実装する
    - _要件: 2.1（AI 対戦）_

- [ ] 8. GUI 基盤の実装（Fyne）

  - [ ] 8.1 アプリケーション基盤の実装

    - Fyne アプリケーションの初期化とメインウィンドウを作成する
    - アプリケーション状態管理（AppState）を実装する
    - 基本的なナビゲーションシステムを実装する
    - _要件: 5.1, 5.4_

  - [ ] 8.2 基本 UI コンポーネントの実装
    - カード表示ウィジェット（CardWidget）を実装する
    - ボタン、モーダル、ローディング表示などの基本コンポーネントを実装する
    - レイアウトマネージャーとテーマ設定を実装する
    - _要件: 5.1, 5.3_

- [ ] 9. メインメニューとデッキビルダー UI の実装

  - [ ] 9.1 メインメニューの実装

    - メインメニュー画面（対戦開始、デッキ構築、カードコレクション）を実装する
    - 設定画面とゲーム終了機能を実装する
    - _要件: 5.1_

  - [ ] 9.2 デッキビルダー UI の実装
    - デッキ構築画面のレイアウトを実装する
    - カードコレクション表示とフィルタリング機能を実装する
    - デッキリスト表示と編集機能を実装する
    - デッキ保存・読み込み UI を実装する
    - _要件: 1.1, 1.2, 3.3_

- [ ] 10. ゲーム画面 UI の実装

  - [ ] 10.1 ゲームボードの実装

    - ゲームボード全体のレイアウトを実装する
    - バトルエリア、エネルギーエリア、負のエネルギーエリアの表示を実装する
    - デッキエリアとトラッシュエリアの表示を実装する
    - _要件: 5.2_

  - [ ] 10.2 プレイヤーエリアとインタラクションの実装
    - 手札表示とカード選択機能を実装する
    - フェーズ表示とターン管理 UI を実装する
    - アクションボタン（カードプレイ、アタック、フェーズ終了）を実装する
    - _要件: 5.2, 5.3_

- [ ] 11. ゲームフローの統合

  - [ ] 11.1 ゲーム開始からメインフェーズまでの統合

    - ゲーム初期化（デッキシャッフル、初期手札配布）を統合する
    - 先攻後攻決定とゲーム開始フローを統合する
    - スタート・ドロー・エネルギーフェーズの自動処理を統合する
    - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

  - [ ] 11.2 メインフェーズとアタックフローの統合
    - メインフェーズでのカードプレイと AI 行動を統合する
    - アタック・ブロック・バトル解決の完全なフローを統合する
    - エンドフェーズと手札制限処理を統合する
    - _要件: 2.6, 2.7, 2.8, 2.9, 2.10, 2.11, 2.12_

- [ ] 12. エラーハンドリングとユーザーフィードバック

  - エラー処理システム（GameError）を実装する
  - ユーザー向けエラーメッセージとダイアログを実装する
  - ログシステムとデバッグ機能を実装する
  - _要件: 4.9_

- [ ] 13. テストとデバッグ機能

  - [ ] 13.1 ユニットテストの実装

    - カードシステムとゲームルールのユニットテストを作成する
    - AI エンジンのテストケースを作成する
    - データベース操作のテストを作成する

  - [ ] 13.2 統合テストの実装
    - ゲーム全体フローの統合テストを作成する
    - UI コンポーネントのテストを作成する
    - エラーハンドリングのテストを作成する

- [ ] 14. パフォーマンス最適化と仕上げ

  - [ ] 14.1 パフォーマンス最適化の実装

    - 画像キャッシュとメモリ管理の最適化を実装する
    - データベースクエリの最適化を実装する
    - UI レンダリングの最適化を実装する

  - [ ] 14.2 アプリケーションの仕上げ
    - アプリケーションアイコンとリソースを追加する
    - macOS 向けのビルド設定とパッケージングを設定する
    - 最終的な動作確認とバグ修正を行う
